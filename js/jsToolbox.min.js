// LICENSE: LGPL 3 - https://www.gnu.org/licenses/lgpl-3.0.txt

// s. https://github.com/mkloubert/jsToolbox

Array.prototype.isEmpty=function(){return this.length<1},Array.prototype.isNotEmpty=function(){return!this.isEmpty()},Number.prototype.padLeft=function(t,e){return"undefined"==typeof e&&(e="0"),this.toString().padLeft(t,e)},String.prototype.endsWith=function(t){return this.indexOf(t,this.length-t.length)>-1},String.prototype.format=function(){return this.formatArray(arguments)},String.prototype.formatArray=function(t){return t||(t=[]),this.replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e})},String.prototype.isEmpty=function(){return this.length<1},String.prototype.isNotEmpty=function(){return!this.isEmpty()},String.isNullOrWhitespace=function(t){return null==t||t.isWhitespace()},String.prototype.isWhitespace=function(){return this.trim().isEmpty()},String.prototype.padLeft=function(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=" ");var n=this;return t+1>=n.length&&(n=Array(t+1-n.length).join(e)+n),n},String.prototype.startsWith=function(t){return 0==this.indexOf(t)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}),String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),String.prototype.ucwords=function(){var t=this.toLowerCase();return t.replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,function(t){return t.toUpperCase()})};var jsToolboxMJK={};!function($jsTB){Object.defineProperty($jsTB,"$",{get:function(){return this.jQuery}}),Object.defineProperty($jsTB,"body",{get:function(){return this.jQuery("body")}}),Object.defineProperty($jsTB,"head",{get:function(){return this.jQuery("head")}}),Object.defineProperty($jsTB,"jQuery",{get:function(){return window.jQuery}}),Object.defineProperty($jsTB,"noop",{get:function(){return this.jQuery.noop}}),Object.defineProperty($jsTB,"now",{get:function(){return new Date}}),Object.defineProperty($jsTB,"nowUTC",{get:function(){var t=this.now;return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())}}),$jsTB.events={},$jsTB.events.__defaultPageLoadedAction=function(){for(var t={},e=null,n=null,r=0;r<$jsTB.page.__onPageLoadedActions.length;r++){var o=$jsTB.page.__onPageLoadedActions[r],i=o.action,s=o.state,u=o.options,a={addVar:function(t,e,n){return n=$jsTB.jQuery.extend({},n),Object.defineProperty(this.vars,$jsTB.jQuery.trim(t),{get:$jsTB.funcs.asFunc(e)}),this},clearVars:function(t){return t=$jsTB.jQuery.extend({},t),this.vars={},this},continueOnError:u.continueOnError,index:r,lastErr:e,prevState:n,nextState:null,state:s};Object.defineProperty(a,"isFirst",{get:function(){return 0==this.index}}),Object.defineProperty(a,"isLast",{get:function(){return this.index+1==$jsTB.page.__onPageLoadedActions.length}}),Object.defineProperty(a,"vars",{get:function(){return t},set:function(e){t=e}}),e=null;try{i&&i($jsTB,a)}catch(c){if(e=c,a.error=c,u.error?(null==a.continueOnError&&(a.continueOnError=!0),u.error($jsTB,a)):null==a.continueOnError&&(a.continueOnError=!1),!u.continueOnError)throw c}finally{u.complete&&u.complete($jsTB,a)}n=a.nextState}},$jsTB.events.pageLoaded=$jsTB.events.__defaultPageLoadedAction,$jsTB.funcs={},$jsTB.funcs.asFunc=function(t){var e=t;return this.isFunc(e)||(e=function(){return t}),e},$jsTB.funcs.asJQuery=function(t){return this.isJQuery(t)||(t=$jsTB.jQuery(t)),t},$jsTB.funcs.buildBatch=function(t){t=$jsTB.jQuery.extend({stopOnFirstError:!0},t);var e=[],n={};return n.add=function(t){for(var e={args:[],func:t},n=1;n<arguments.length;n++)e.args.push(arguments[n]);return this},n.clear=function(){return e=[],this},n.__getItem=function(t){return e[t]},n.invoke=function(e){e=$jsTB.jQuery.extend({stopOnFirstError:t.stopOnFirstError?!0:!1},e);for(var n=[],r=0;r<this.length;r++){var o=this.__getItem(r),i=$jsTB.funcs.invokeArray(o.func,o.args);if(n.push(i),i.hasFailed&&e.stopOnFirstError)break}return n},Object.defineProperty(n,"length",{get:function(){return e.length}}),n},$jsTB.funcs.eval=function(t){return $jsTB.jQuery.globalEval(t)},$jsTB.funcs.invoke=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);return this.invokeArray(t,e)},$jsTB.funcs.invokeArray=function(fn,args){args||(args=[]);var result={args:args,hasBeenInvoked:!1};Object.defineProperty(result,"duration",{get:function(){return this.startTime&&this.endTime?this.endTime-this.startTime:void 0}}),Object.defineProperty(result,"hasFailed",{get:function(){return this.error?!0:!1}});try{if(fn){result.hasBeenInvoked=!0;for(var code="fn(",i=0;i<result.args.length;i++)i>0&&(code+=","),code+="result.args[{0}]".format(i);code+=");",result.startTime=$jsTB.now,result.result=eval(code),result.endTime=$jsTB.now}}catch(e){result.endTime=$jsTB.now,result.error=e}return result},$jsTB.funcs.isArray=function(t){return $jsTB.jQuery.isArray(t)},$jsTB.funcs.isFunc=function(t){return $jsTB.jQuery.isFunction(t)},$jsTB.funcs.isJQuery=function(t){return t instanceof jQuery},$jsTB.funcs.isString=function(t){return"string"==typeof t||t instanceof String},$jsTB.funcs.openPopup=function(t,e){e||(e="jsTBPopup"),this.isString(e)&&(e={name:e}),e=$jsTB.jQuery.extend({canResize:!0,height:400,width:640},e);var n=window.open(t,e.name,"width={0},height={1},resizable={2}".format(e.width,e.height,e.canResize?"yes":"no"));return $jsTB.jQuery(n)},$jsTB.funcs.registerForFileUpload=function(t,e){e=$jsTB.jQuery.extend({},e),t=this.asJQuery(t);var n;return t.find("input[type=file]").on("change",function(r){var o=$jsTB.jQuery(this);if(n=[],$jsTB.jQuery.each(r.target.files,function(t,e){var r={file:e,name:o.attr("name")};"undefined"==typeof r.name&&(r.name=t),n.push(r)}),e.change){var i={files:n,options:e,submit:function(){t.submit()}};e.change(i)}}).trigger("change"),t.on("submit",function(r){r.stopPropagation(),r.preventDefault();var o=new FormData;$jsTB.jQuery.each(n,function(t,e){o.append(e.name,e.file)}),t.find("input").not("input[type=file]").not("input[type=submit]").not("input[type=button]").not("input[type=image]").each(function(t,e){var n=$jsTB.jQuery(e),r=n.attr("name");"undefined"==typeof r&&(r=t),o.append(r,n.val())});var i={cancel:!1,data:o,form:t,options:e};e.beforeSubmit&&e.beforeSubmit(i),i.cancel||("undefined"==typeof i.options.action&&(i.options.action=t.attr("action")),"undefined"==typeof i.options.method&&(i.options.method=t.attr("method")),i.options.method||(i.options.method="POST"),$jsTB.jQuery.ajax({cache:!1,contentType:!1,data:o,processData:!1,type:i.options.method,url:i.options.action,complete:function(e,n){i.options.complete&&i.options.complete({form:t,status:n,xhr:e})},error:function(e,n,r){i.options.error&&i.options.error({error:r,form:t,status:n,xhr:e})},success:function(e,n,r){i.options.success&&i.options.success({data:e,form:t,status:n,xhr:r})},xhr:function(){var e=$jsTB.jQuery.ajaxSettings.xhr();return e.upload.onprogress=function(n){if(i.options.progress){var r={form:t,total:n.total,uploaded:n.loaded,xhr:e};Object.defineProperty(r,"percentage",{get:function(){return 100*this.progress}}),Object.defineProperty(r,"progress",{get:function(){return 0!=this.total?this.uploaded/this.total:0}}),Object.defineProperty(r,"remaining",{get:function(){return this.total-this.uploaded}}),i.options.progress(r)}},e}}))}),t},$jsTB.funcs.toStringSafe=function(t){var e=t;return e||(e=""),this.isString(e)||(e=e.toString(),e||(e="")),e},$jsTB.funcs.trim=function(t){return this.toStringSafe(t).trim()},$jsTB.funcs.trimLeft=function(t){return this.toStringSafe(t).trimLeft()},$jsTB.funcs.trimRight=function(t){return this.toStringSafe(t).trimRight()},$jsTB.funcs.waitForPage=function(t,e,n){return n=$jsTB.jQuery.extend({waitUntilRetry:500},n),e||(e=null),$jsTB.page.context?void t($jsTB,e):void setTimeout(function(){$jsTB.funcs.waitForPage(t,e,n)},n.waitUntilRetry)},$jsTB.page={},$jsTB.page.__onPageLoadedActions=[],$jsTB.page.addElement=function(t,e,n){return n=$jsTB.jQuery.extend({target:this.elements},n),e=$jsTB.funcs.asJQuery(e),Object.defineProperty(n.target,$jsTB.jQuery.trim(t),{get:$jsTB.funcs.asFunc(e)}),this},$jsTB.page.addOnLoaded=function(t,e,n){return n=$jsTB.jQuery.extend({continueOnError:null},n),e||(e=null),$jsTB.page.__onPageLoadedActions.push({action:t,options:n,state:e}),this},$jsTB.page.addVar=function(t,e,n){return n=$jsTB.jQuery.extend({target:this.vars},n),Object.defineProperty(n.target,$jsTB.jQuery.trim(t),{get:$jsTB.funcs.asFunc(e)}),this},$jsTB.page.elements={},$jsTB.page.funcs={},$jsTB.page.lang={},$jsTB.page.request={},$jsTB.page.request.GET={},document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g,function(t,e,n){var r=function(t){return decodeURIComponent(t.split("+").join(" "))};$jsTB.page.request.GET[r(e).toLowerCase()]=r(n)}),$jsTB.page.vars={},$jsTB.jQuery(document).ready(function(){var t={};if($jsTB.page.context=t,$jsTB.events.pageLoaded){var e={};e.invokeDefault=function(){$jsTB.events.__defaultPageLoadedAction($jsTB,e)},$jsTB.events.pageLoaded($jsTB,e)}})}(jsToolboxMJK),"undefined"==typeof $jsTB&&($jsTB=jsToolboxMJK);